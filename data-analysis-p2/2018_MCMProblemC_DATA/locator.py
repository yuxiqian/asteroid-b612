#!/usr/bin/env python

import pickle
import pandas as pd
from structor import County
from utils import find_county

loc_data = pd.read_csv('locations.csv')

target_states = ['Ohio', 'Kentucky', 'West Virginia', 'Virginia', 'Pennsylvania']

order_count = len(loc_data)

counties = []

params = ["HC01_VC03", "HC02_VC03", "HC03_VC03", "HC04_VC03", "HC01_VC04", "HC02_VC04", "HC03_VC04", "HC04_VC04", "HC01_VC06", "HC02_VC06", "HC03_VC06", "HC04_VC06", "HC01_VC07", "HC02_VC07", "HC03_VC07", "HC04_VC07", "HC01_VC08", "HC02_VC08", "HC03_VC08", "HC04_VC08", "HC01_VC09", "HC02_VC09", "HC03_VC09", "HC04_VC09", "HC01_VC10", "HC02_VC10", "HC03_VC10", "HC04_VC10", "HC01_VC11", "HC02_VC11", "HC03_VC11", "HC04_VC11", "HC01_VC12", "HC02_VC12", "HC03_VC12", "HC04_VC12", "HC01_VC13", "HC02_VC13", "HC03_VC13", "HC04_VC13", "HC01_VC14", "HC02_VC14", "HC03_VC14", "HC04_VC14", "HC01_VC15", "HC02_VC15", "HC03_VC15", "HC04_VC15", "HC01_VC17", "HC02_VC17", "HC03_VC17", "HC04_VC17", "HC01_VC18", "HC02_VC18", "HC03_VC18", "HC04_VC18", "HC01_VC20", "HC02_VC20", "HC03_VC20", "HC04_VC20", "HC01_VC21", "HC02_VC21", "HC03_VC21", "HC04_VC21", "HC01_VC25", "HC02_VC25", "HC03_VC25", "HC04_VC25", "HC01_VC26", "HC02_VC26", "HC03_VC26", "HC04_VC26", "HC01_VC27", "HC02_VC27", "HC03_VC27", "HC04_VC27", "HC01_VC28", "HC02_VC28", "HC03_VC28", "HC04_VC28", "HC01_VC29", "HC02_VC29", "HC03_VC29", "HC04_VC29", "HC01_VC30", "HC02_VC30", "HC03_VC30", "HC04_VC30", "HC01_VC31", "HC02_VC31", "HC03_VC31", "HC04_VC31", "HC01_VC35", "HC02_VC35", "HC03_VC35", "HC04_VC35", "HC01_VC36", "HC02_VC36", "HC03_VC36", "HC04_VC36", "HC01_VC37", "HC02_VC37", "HC03_VC37", "HC04_VC37", "HC01_VC38", "HC02_VC38", "HC03_VC38", "HC04_VC38", "HC01_VC39", "HC02_VC39", "HC03_VC39", "HC04_VC39", "HC01_VC40", "HC02_VC40", "HC03_VC40", "HC04_VC40", "HC01_VC42", "HC02_VC42", "HC03_VC42", "HC04_VC42", "HC01_VC43", "HC02_VC43", "HC03_VC43", "HC04_VC43", "HC01_VC44", "HC02_VC44", "HC03_VC44", "HC04_VC44", "HC01_VC45", "HC02_VC45", "HC03_VC45", "HC04_VC45", "HC01_VC46", "HC02_VC46", "HC03_VC46", "HC04_VC46", "HC01_VC47", "HC02_VC47", "HC03_VC47", "HC04_VC47", "HC01_VC51", "HC02_VC51", "HC03_VC51", "HC04_VC51", "HC01_VC52", "HC02_VC52", "HC03_VC52", "HC04_VC52", "HC01_VC53", "HC02_VC53", "HC03_VC53", "HC04_VC53", "HC01_VC54", "HC02_VC54", "HC03_VC54", "HC04_VC54", "HC01_VC55", "HC02_VC55", "HC03_VC55", "HC04_VC55", "HC01_VC56", "HC02_VC56", "HC03_VC56", "HC04_VC56", "HC01_VC57", "HC02_VC57", "HC03_VC57", "HC04_VC57", "HC01_VC61", "HC02_VC61", "HC03_VC61", "HC04_VC61", "HC01_VC62", "HC02_VC62", "HC03_VC62", "HC04_VC62", "HC01_VC64", "HC02_VC64", "HC03_VC64", "HC04_VC64", "HC01_VC65", "HC02_VC65", "HC03_VC65", "HC04_VC65", "HC01_VC66", "HC02_VC66", "HC03_VC66", "HC04_VC66", "HC01_VC67", "HC02_VC67", "HC03_VC67", "HC04_VC67", "HC01_VC69", "HC02_VC69", "HC03_VC69", "HC04_VC69", "HC01_VC70", "HC02_VC70", "HC03_VC70", "HC04_VC70", "HC01_VC71", "HC02_VC71", "HC03_VC71", "HC04_VC71", "HC01_VC75", "HC02_VC75", "HC03_VC75", "HC04_VC75", "HC01_VC76", "HC02_VC76", "HC03_VC76", "HC04_VC76", "HC01_VC77", "HC02_VC77", "HC03_VC77", "HC04_VC77", "HC01_VC78", "HC02_VC78", "HC03_VC78", "HC04_VC78", "HC01_VC79", "HC02_VC79", "HC03_VC79", "HC04_VC79", "HC01_VC80", "HC02_VC80", "HC03_VC80", "HC04_VC80", "HC01_VC84", "HC02_VC84", "HC03_VC84", "HC04_VC84", "HC01_VC85", "HC02_VC85", "HC03_VC85", "HC04_VC85", "HC01_VC86", "HC02_VC86", "HC03_VC86", "HC04_VC86", "HC01_VC87", "HC02_VC87", "HC03_VC87", "HC04_VC87", "HC01_VC88", "HC02_VC88", "HC03_VC88", "HC04_VC88", "HC01_VC89", "HC02_VC89", "HC03_VC89", "HC04_VC89", "HC01_VC90", "HC02_VC90", "HC03_VC90", "HC04_VC90", "HC01_VC91", "HC02_VC91", "HC03_VC91", "HC04_VC91", "HC01_VC93", "HC02_VC93", "HC03_VC93", "HC04_VC93", "HC01_VC94", "HC02_VC94", "HC03_VC94", "HC04_VC94", "HC01_VC98", "HC02_VC98", "HC03_VC98", "HC04_VC98", "HC01_VC99", "HC02_VC99", "HC03_VC99", "HC04_VC99", "HC01_VC103", "HC02_VC103", "HC03_VC103", "HC04_VC103", "HC01_VC104", "HC02_VC104", "HC03_VC104", "HC04_VC104", "HC01_VC106", "HC02_VC106", "HC03_VC106", "HC04_VC106", "HC01_VC107", "HC02_VC107", "HC03_VC107", "HC04_VC107", "HC01_VC109", "HC02_VC109", "HC03_VC109", "HC04_VC109", "HC01_VC110", "HC02_VC110", "HC03_VC110", "HC04_VC110", "HC01_VC112", "HC02_VC112", "HC03_VC112", "HC04_VC112", "HC01_VC113", "HC02_VC113", "HC03_VC113", "HC04_VC113", "HC01_VC117", "HC02_VC117", "HC03_VC117", "HC04_VC117", "HC01_VC118", "HC02_VC118", "HC03_VC118", "HC04_VC118", "HC01_VC119", "HC02_VC119", "HC03_VC119", "HC04_VC119", "HC01_VC120", "HC02_VC120", "HC03_VC120", "HC04_VC120", "HC01_VC121", "HC02_VC121", "HC03_VC121", "HC04_VC121", "HC01_VC122", "HC02_VC122", "HC03_VC122", "HC04_VC122", "HC01_VC123", "HC02_VC123", "HC03_VC123", "HC04_VC123", "HC01_VC124", "HC02_VC124", "HC03_VC124", "HC04_VC124", "HC01_VC128", "HC02_VC128", "HC03_VC128", "HC04_VC128", "HC01_VC129", "HC02_VC129", "HC03_VC129", "HC04_VC129", "HC01_VC130", "HC02_VC130", "HC03_VC130", "HC04_VC130", "HC01_VC131", "HC02_VC131", "HC03_VC131", "HC04_VC131", "HC01_VC132", "HC02_VC132", "HC03_VC132", "HC04_VC132", "HC01_VC133", "HC02_VC133", "HC03_VC133", "HC04_VC133", "HC01_VC134", "HC02_VC134", "HC03_VC134", "HC04_VC134", "HC01_VC138", "HC02_VC138", "HC03_VC138", "HC04_VC138", "HC01_VC139", "HC02_VC139", "HC03_VC139", "HC04_VC139", "HC01_VC140", "HC02_VC140", "HC03_VC140", "HC04_VC140", "HC01_VC144", "HC02_VC144", "HC03_VC144", "HC04_VC144", "HC01_VC146", "HC02_VC146", "HC03_VC146", "HC04_VC146", "HC01_VC147", "HC02_VC147", "HC03_VC147", "HC04_VC147", "HC01_VC148", "HC02_VC148", "HC03_VC148", "HC04_VC148", "HC01_VC150", "HC02_VC150", "HC03_VC150", "HC04_VC150", "HC01_VC151", "HC02_VC151", "HC03_VC151", "HC04_VC151", "HC01_VC152", "HC02_VC152", "HC03_VC152", "HC04_VC152", "HC01_VC156", "HC02_VC156", "HC03_VC156", "HC04_VC156", "HC01_VC157", "HC02_VC157", "HC03_VC157", "HC04_VC157", "HC01_VC158", "HC02_VC158", "HC03_VC158", "HC04_VC158", "HC01_VC159", "HC02_VC159", "HC03_VC159", "HC04_VC159", "HC01_VC160", "HC02_VC160", "HC03_VC160", "HC04_VC160", "HC01_VC161", "HC02_VC161", "HC03_VC161", "HC04_VC161", "HC01_VC162", "HC02_VC162", "HC03_VC162", "HC04_VC162", "HC01_VC166", "HC02_VC166", "HC03_VC166", "HC04_VC166", "HC01_VC167", "HC02_VC167", "HC03_VC167", "HC04_VC167", "HC01_VC168", "HC02_VC168", "HC03_VC168", "HC04_VC168", "HC01_VC170", "HC02_VC170", "HC03_VC170", "HC04_VC170", "HC01_VC171", "HC02_VC171", "HC03_VC171", "HC04_VC171", "HC01_VC172", "HC02_VC172", "HC03_VC172", "HC04_VC172", "HC01_VC173", "HC02_VC173", "HC03_VC173", "HC04_VC173", "HC01_VC174", "HC02_VC174", "HC03_VC174", "HC04_VC174", "HC01_VC175", "HC02_VC175", "HC03_VC175", "HC04_VC175", "HC01_VC176", "HC02_VC176", "HC03_VC176", "HC04_VC176", "HC01_VC177", "HC02_VC177", "HC03_VC177", "HC04_VC177", "HC01_VC178", "HC02_VC178", "HC03_VC178", "HC04_VC178", "HC01_VC182", "HC02_VC182", "HC03_VC182", "HC04_VC182", "HC01_VC183", "HC02_VC183", "HC03_VC183", "HC04_VC183", "HC01_VC184", "HC02_VC184", "HC03_VC184", "HC04_VC184", "HC01_VC185", "HC02_VC185", "HC03_VC185", "HC04_VC185", "HC01_VC186", "HC02_VC186", "HC03_VC186", "HC04_VC186", "HC01_VC187", "HC02_VC187", "HC03_VC187", "HC04_VC187", "HC01_VC188", "HC02_VC188", "HC03_VC188", "HC04_VC188", "HC01_VC189", "HC02_VC189", "HC03_VC189", "HC04_VC189", "HC01_VC190", "HC02_VC190", "HC03_VC190", "HC04_VC190", "HC01_VC191", "HC02_VC191", "HC03_VC191", "HC04_VC191", "HC01_VC192", "HC02_VC192", "HC03_VC192", "HC04_VC192", "HC01_VC193", "HC02_VC193", "HC03_VC193", "HC04_VC193", "HC01_VC194", "HC02_VC194", "HC03_VC194", "HC04_VC194", "HC01_VC195", "HC02_VC195", "HC03_VC195", "HC04_VC195", "HC01_VC196", "HC02_VC196", "HC03_VC196", "HC04_VC196", "HC01_VC197", "HC02_VC197", "HC03_VC197", "HC04_VC197", "HC01_VC198", "HC02_VC198", "HC03_VC198", "HC04_VC198", "HC01_VC199", "HC02_VC199", "HC03_VC199", "HC04_VC199", "HC01_VC200", "HC02_VC200", "HC03_VC200", "HC04_VC200", "HC01_VC201", "HC02_VC201", "HC03_VC201", "HC04_VC201", "HC01_VC202", "HC02_VC202", "HC03_VC202", "HC04_VC202", "HC01_VC203", "HC02_VC203", "HC03_VC203", "HC04_VC203", "HC01_VC204", "HC02_VC204", "HC03_VC204", "HC04_VC204", "HC01_VC205", "HC02_VC205", "HC03_VC205", "HC04_VC205", "HC01_VC206", "HC02_VC206", "HC03_VC206", "HC04_VC206", "HC01_VC207", "HC02_VC207", "HC03_VC207", "HC04_VC207", "HC01_VC208", "HC02_VC208", "HC03_VC208", "HC04_VC208", "HC01_VC209", "HC02_VC209", "HC03_VC209", "HC04_VC209"]


for loc_item in range(order_count):
    it = loc_data.iloc[loc_item]
    if it['state_name'] in target_states:
        if find_county(it['county_name'], counties, it['state_name']) == None:
            it_ct = County("%s" % (it['county_name']), it['state_name'],
                        it['lat'], it['lng'], it['density'])
            print(it_ct)
            counties.append(it_ct)


# for i in counties:
#     print(i.literal_name)

# input("len=%d" % len(counties))

for year in range(10, 17):
    path = "ACS_%d_5YR_DP02/ACS_%d_5YR_DP02_with_ann.csv" % (year, year)
    ann_data = pd.read_csv(path)

    param_list = []
    for line in ann_data:
        param_list.append(line)

    dat_len = len(ann_data)

    for i in range(1, dat_len):
        it = ann_data.iloc[i]

        ct = it['GEO.display-label'].split(', ')[0].replace(' County', '').replace(' city', '')

        county = find_county(ct, counties, it['GEO.display-label'].split(', ')[1])
        if county == None:
            print("Nothing as %s, %s found." % (ct, it['GEO.display-label'].split(', ')[1]))
            input()
            continue

        for p in params:
            if not p in param_list:
                continue
            print("Gonna set %s as %s" % (p, it[p]))
            county.geo_data[year - 10].update({p: it[p]})

      
savefilename = input("Save it to [where].loc... \n>>> ")
output_hal = open("%s.loc" % savefilename, 'wb')  

str_data = pickle.dumps(counties)
output_hal.write(str_data)
output_hal.close()
